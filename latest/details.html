<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Details · RigidBodySim.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>RigidBodySim.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Home</a></li><li><a class="toctext" href="quickstart.html">Quick start guide</a></li><li class="current"><a class="toctext" href="details.html">Details</a><ul class="internal"><li><a class="toctext" href="#ODE-problem-creation-1">ODE problem creation</a></li><li><a class="toctext" href="#control-1">Control</a></li><li><a class="toctext" href="#Visualization-1">Visualization</a></li><li><a class="toctext" href="#Utilities-1">Utilities</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="details.html">Details</a></li></ul><a class="edit-page" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/master/docs/src/details.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Details</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Details-1" href="#Details-1">Details</a></h1><h2><a class="nav-anchor" id="ODE-problem-creation-1" href="#ODE-problem-creation-1">ODE problem creation</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Core.Dynamics" href="#RigidBodySim.Core.Dynamics"><code>RigidBodySim.Core.Dynamics</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-julia">Dynamics(mechanism)
Dynamics(mechanism, control!; setparams!)
</code></pre><p>Create a <code>Dynamics</code> object, representing either the passive or closed-loop dynamics of a <code>RigidBodyDynamics.Mechanism</code>.</p><p>The <code>control!</code> argument is a callable with the signature <code>control!(τ, t, state)</code>, where <code>τ</code> is the torque vector to be set in the body of <code>control!</code>, <code>t</code> is the current time, and <code>state</code> is a <code>MechanismState</code> object. By default, <code>control!</code> is <a href="details.html#RigidBodySim.Core.zero_control!"><code>zero_control!</code></a> (resulting in the passive dynamics).</p><p>The <code>setparams!</code> keyword argument is a callable with the signature <code>setparams!(state, p)</code> where <code>state</code> is a <code>MechanismState</code> and <code>p</code> is a vector of parameters, as used in OrdinaryDiffEq.jl.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/core.jl#L54-L63">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiffEqBase.ODEProblem-Tuple{RigidBodySim.Core.Dynamics,Union{AbstractArray{T,1} where T, RigidBodyDynamics.MechanismState},Any}" href="#DiffEqBase.ODEProblem-Tuple{RigidBodySim.Core.Dynamics,Union{AbstractArray{T,1} where T, RigidBodyDynamics.MechanismState},Any}"><code>DiffEqBase.ODEProblem</code></a> — <span class="docstring-category">Method</span>.</div><div><pre><code class="language-julia">ODEProblem(dynamics, x0, tspan)
ODEProblem(dynamics, x0, tspan, p; callback, kwargs...)
</code></pre><p>Create a <code>DiffEqBase.ODEProblem</code> associated with the dynamics of a <code>RigidBodyDynamics.Mechanism</code>.</p><p>The initial state <code>x0</code> can be either a <a href="http://JuliaRobotics.github.io/RigidBodyDynamics.jl/stable/mechanismstate.html#RigidBodyDynamics.MechanismState"><code>RigidBodyDynamics.MechanismState</code></a>), or an <code>AbstractVector</code> containing the initial state represented as <code>[q; v; s]</code>, where <code>q</code> is the configuration vector, <code>v</code> is the velocity vector, and <code>s</code> is the vector of additional states.</p><p>The <code>callback</code> keyword argument can be used to pass in additional <a href="http://docs.juliadiffeq.org/stable/features/callback_functions.html#Using-Callbacks-1">DifferentialEquations.jl callbacks</a>.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/core.jl#L100-L110">source</a></section><h2><a class="nav-anchor" id="control-1" href="#control-1">Control</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Core.zero_control!" href="#RigidBodySim.Core.zero_control!"><code>RigidBodySim.Core.zero_control!</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">zero_control!(τ, t, state)
</code></pre><p>A &#39;zero&#39; controller, i.e. one that sets all control torques to zero at all times.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/core.jl#L41-L43">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Core.controlcallback" href="#RigidBodySim.Core.controlcallback"><code>RigidBodySim.Core.controlcallback</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">controlcallback(control!)
</code></pre><p>Can be used to create a callback associated with a given controller.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/core.jl#L95-L97">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Control.PeriodicController" href="#RigidBodySim.Control.PeriodicController"><code>RigidBodySim.Control.PeriodicController</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-julia">struct PeriodicController{Tau&lt;:(AbstractArray{T,1} where T), T&lt;:Number, C, I}</code></pre><p>A <code>PeriodicController</code> can be used to simulate a digital controller that runs at a fixed rate (in terms of simulation time). It does so by performing a zero-order hold on a provided control function.</p><p><code>PeriodicController</code>s can be constructed using</p><pre><code class="language-julia">PeriodicController(τ, Δt, control!; initialize = DiffEqBase.INITIALIZE_DEFAULT, save_positions = (false, false))</code></pre><p>where <code>control!</code> is a controller satisfying the standard RigidBodySim controller signature (<code>control!(τ, Δt, state)</code>), <code>Δt</code> is the simulation time interval between calls to the <code>control!</code> function, and <code>τ</code> is used to call <code>control!</code>. The <code>initialize</code> and <code>save_positions</code> keyword arguments are documented in the <a href="http://docs.juliadiffeq.org/release-4.0/features/callback_functions.html#DiscreteCallback-1"><code>DiscreteCallback</code></a> section of the DifferentialEquations documentation.</p><p><code>PeriodicController</code>s are callable objects, and themselves fit the standard RigidBodySim controller signature.</p><p>A <code>DiffEqCallbacks.PeriodicCallback</code> can be created from a <code>PeriodicController</code>, and is used to stop ODE integration exactly every <code>Δt</code> seconds, so that the <code>control!</code> function can be called. Typically, users will not have to explicitly create this <code>PeriodicCallback</code>, as it is automatically created and added to the <code>ODEProblem</code> when the <code>PeriodicController</code> is passed into the RigidBodySim-provided <code>DiffEqBase.ODEProblem</code> constructor overload.</p><p><strong>Examples</strong></p><p>In the following example, a <code>PeriodicController</code> is used to simulate a digital PD controller running at a fixed rate of 200 Hz.</p><pre><code class="language-julia-repl">julia&gt; using RigidBodySim, RigidBodyDynamics, OrdinaryDiffEq

julia&gt; mechanism = parse_urdf(Float64, Pkg.dir(&quot;RigidBodySim&quot;, &quot;test&quot;, &quot;urdf&quot;, &quot;Acrobot.urdf&quot;));

julia&gt; state = MechanismState(mechanism);

julia&gt; set_configuration!(state, [0.1; 0.2]);

julia&gt; controlcalls = Ref(0);

julia&gt; pdcontrol!(τ, t, state) = (controlcalls[] += 1; τ .= -20 .* velocity(state) .- 100 .* configuration(state));

julia&gt; τ = zeros(velocity(state)); Δt = 1 / 200
0.005

julia&gt; problem = ODEProblem(Dynamics(mechanism, PeriodicController(τ, Δt, pdcontrol!)), state, (0., 5.));

julia&gt; sol = solve(problem, Vern7());

julia&gt; sol.u[end]
4-element Array{Float64,1}:
 -3.25923e-5
 -1.67942e-5
  8.16715e-7
  1.55292e-8

julia&gt; @assert all(x -&gt; isapprox(x, 0, atol = 1e-4), sol.u[end]) # ensure state converges to zero

julia&gt; controlcalls[]
1001</code></pre></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/control.jl#L28-L93">source</a></section><h2><a class="nav-anchor" id="Visualization-1" href="#Visualization-1">Visualization</a></h2><p>RigidBodySim uses <a href="https://github.com/JuliaRobotics/MeshCatMechanisms.jl">MeshCatMechanisms.jl</a> for 3D visualization.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Visualization.GUI" href="#RigidBodySim.Visualization.GUI"><code>RigidBodySim.Visualization.GUI</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-julia">GUI(visualizer)
</code></pre><p>Create a new RigidBodySim graphical user interface from a <code>MeshCatMechanisms.MechanismVisualizer</code>.</p><p>Use <code>open(gui)</code> to open the GUI in a standalone window.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/visualization.jl#L174-L178">source</a><div><pre><code class="language-julia">GUI(mechanism, args)
</code></pre><p>Create a new RigidBodySim graphical user interface for the given Mechanism. All arguments are passed on to the <code>MeshCatMechanisms.MechanismVisualizer</code> constructor.</p><p>Use <code>open(gui)</code> to open the GUI in a standalone window.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/visualization.jl#L181-L186">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Visualization.SimulationControls" href="#RigidBodySim.Visualization.SimulationControls"><code>RigidBodySim.Visualization.SimulationControls</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-julia">SimulationControls()
</code></pre><p>Create a new <code>SimulationControls</code> object, which may be used to pause and terminate the simulation.</p><p>The controls can be displayed in a standalone window using <code>open(controls, Blink.Window())</code>.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/visualization.jl#L99-L103">source</a></section><h2><a class="nav-anchor" id="Utilities-1" href="#Utilities-1">Utilities</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="RigidBodySim.Core.configuration_renormalizer" href="#RigidBodySim.Core.configuration_renormalizer"><code>RigidBodySim.Core.configuration_renormalizer</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">configuration_renormalizer(state)
configuration_renormalizer(state, condition)
</code></pre><p><code>configuration_renormalizer</code> can be used to create a callback that projects the configuration of a mechanism&#39;s state onto the configuration manifold. This may be necessary for mechanism&#39;s with e.g. quaternion-parameterized orientations as part of their joint configuration vectors, as numerical integration can cause the configuration to drift away from the unit norm constraints.</p><p>The callback is implemented as a <a href="http://docs.juliadiffeq.org/stable/features/callback_functions.html#DiscreteCallback-1"><code>DiffEqCallbacks.DiscreteCallback</code></a> By default, it is called at every integrator time step.</p></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/RigidBodySim.jl/blob/4e8f3ccf84e683c97406164f204b1eace9519516/src/core.jl#L121-L130">source</a></section><footer><hr/><a class="previous" href="quickstart.html"><span class="direction">Previous</span><span class="title">Quick start guide</span></a></footer></article></body></html>
